generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Map {
  name        String         @id
  options     Json           @default("{}")
  projections Projection[]
  tools       ToolsOnMaps[]
  layers      LayersOnMaps[]
}

model Tool {
  id      Int           @id @default(autoincrement())
  type    String
  options Json          @default("{}")
  maps    ToolsOnMaps[]
}

model ToolsOnMaps {
  mapName String
  toolId  Int
  /// Determines the sort between tools
  index   Int    @default(0)
  /// Allows overridding default tool options (set in Tool) on a per-map basis
  options Json   @default("{}")
  map     Map    @relation(fields: [mapName], references: [name])
  tool    Tool   @relation(fields: [toolId], references: [id])

  @@id([mapName, toolId])
}

model Projection {
  id      Int   @id @default(autoincrement())
  options Json  @default("[]")
  maps    Map[]
}

model Layer {
  id      String         @id @default(cuid())
  type    LayerType
  options Json           @default("{}")
  maps    LayersOnMaps[]
}

model LayersOnMaps {
  id      Int    @id @default(autoincrement())
  mapName String
  layerId String
  map     Map    @relation(fields: [mapName], references: [name])
  layer   Layer  @relation(fields: [layerId], references: [id])
  options Json?
}

enum LayerType {
  ARCGIS
  VECTOR
  WFS
  WFST
  WMS
  WMTS
}
